<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no minimum-scale=1'>
  <title>TLDR Dev Notes</title>
  <link rel='stylesheet' href='/css/main.css'> 
  <link rel="stylesheet" href="/prism/prism.css">
</head>
<body>

  
<header id="header">
  <div id="logo">
    <h1>TLDR Dev Notes</h1>
  </div>

  <nav id="main-nav">
    
      
        <a href="/">Home</a>
      
        <a href="/about/">About</a>
      
        <a href="/contact/">Contact</a>
      
        <a href="/quotes/">Quotes</a>
      
        <a href="/resources/">Resources</a>
      
        <a href="/progress/">What i did</a>
      
    
  </nav>

</header>


  
  <div id="sidebar">
  <h6>Sections</h6>
  
  <ul id="list-sections">
    
      <li><a href="/api/">
        
        APIs
        </a></li>
    
      <li><a href="/aws/">
        
        Amazon Web Services (AWS)
        </a></li>
    
      <li><a href="/bash-scripting/">
        
        Bash Scripting
        </a></li>
    
      <li><a href="/css-sass/">
        
        CSS &amp; Sass
        </a></li>
    
      <li><a href="/cheatsheets/">
        
        Cheatsheets
        </a></li>
    
      <li><a href="/commands/">
        
        Commands
        </a></li>
    
      <li><a href="/databases/">
        
        Databases
        </a></li>
    
      <li><a href="/drafts/">
        
        Drafts
        </a></li>
    
      <li><a href="/git-github/">
        
        Git &amp; Github
        </a></li>
    
      <li><a href="/javascript/">
        
        JavaScript
        </a></li>
    
      <li><a href="/jekyll/">
        
        Jekyll
        </a></li>
    
      <li><a href="/linux/">
        
        Linux
        </a></li>
    
      <li><a href="/misc/">
        
        Misc
        </a></li>
    
      <li><a href="/node-api/">
        
        Node-api
        </a></li>
    
      <li><a href="/nodejs/">
        
        Node.js
        </a></li>
    
      <li><a href="/opencart/">
        
        OpenCart
        </a></li>
    
      <li><a href="/php/">
        
        PHP
        </a></li>
    
      <li><a href="/programming/">
        
        Programming
        </a></li>
    
      <li><a href="/python/">
        
        Python
        </a></li>
    
      <li><a href="/quotes/">
        
        Quotes
        </a></li>
    
      <li><a href="/raspberrypi/">
        
        Raspberry Pi
        </a></li>
    
      <li><a href="/reactjs/">
        
        Reactjs
        </a></li>
    
      <li><a href="/redux/">
        
        Redux
        </a></li>
    
      <li><a href="/resources/">
        
        Resources
        </a></li>
    
      <li><a href="/sysadmin/">
        
        System Administration
        </a></li>
    
      <li><a href="/webdev/">
        
        Web Development
        </a></li>
    
      <li><a href="/workflow/">
        
        Workflow
        </a></li>
    
      <li><a href="/ios-swift/">
        
        iOS &amp; Swift
        </a></li>
    
        </ul>

  
  <section>
    <h6>Tags</h6>
    
      <a href="/tags/amazon-rds">amazon-rds</a>, 
    
      <a href="/tags/amazon-s3">amazon-s3</a>, 
    
      <a href="/tags/api">api</a>, 
    
      <a href="/tags/array-methods">array-methods</a>, 
    
      <a href="/tags/aws">aws</a>, 
    
      <a href="/tags/babel">babel</a>, 
    
      <a href="/tags/backups">backups</a>, 
    
      <a href="/tags/bash">bash</a>, 
    
      <a href="/tags/basics">basics</a>, 
    
      <a href="/tags/bluetooth">bluetooth</a>, 
    
      <a href="/tags/cheatsheet">cheatsheet</a>, 
    
      <a href="/tags/cli">cli</a>, 
    
      <a href="/tags/commands">commands</a>, 
    
      <a href="/tags/compass">compass</a>, 
    
      <a href="/tags/concepts">concepts</a>, 
    
      <a href="/tags/coreblueooth">coreblueooth</a>, 
    
      <a href="/tags/crontab">crontab</a>, 
    
      <a href="/tags/css">css</a>, 
    
      <a href="/tags/database">database</a>, 
    
      <a href="/tags/databases">databases</a>, 
    
      <a href="/tags/date">date</a>, 
    
      <a href="/tags/debian">debian</a>, 
    
      <a href="/tags/editor">editor</a>, 
    
      <a href="/tags/education">education</a>, 
    
      <a href="/tags/es2015">es2015</a>, 
    
      <a href="/tags/firebase">firebase</a>, 
    
      <a href="/tags/format">format</a>, 
    
      <a href="/tags/free">free</a>, 
    
      <a href="/tags/fundamentals">fundamentals</a>, 
    
      <a href="/tags/getting-started">getting-started</a>, 
    
      <a href="/tags/git">git</a>, 
    
      <a href="/tags/github-pages">github-pages</a>, 
    
      <a href="/tags/guides">guides</a>, 
    
      <a href="/tags/hacking">hacking</a>, 
    
      <a href="/tags/hosting">hosting</a>, 
    
      <a href="/tags/how-to">how-to</a>, 
    
      <a href="/tags/hugo">hugo</a>, 
    
      <a href="/tags/ios">ios</a>, 
    
      <a href="/tags/javascript">javascript</a>, 
    
      <a href="/tags/jekyll">jekyll</a>, 
    
      <a href="/tags/js">js</a>, 
    
      <a href="/tags/keychain">keychain</a>, 
    
      <a href="/tags/lamp">lamp</a>, 
    
      <a href="/tags/lfs">lfs</a>, 
    
      <a href="/tags/linux">linux</a>, 
    
      <a href="/tags/macos">macos</a>, 
    
      <a href="/tags/markdown">markdown</a>, 
    
      <a href="/tags/media-queries">media-queries</a>, 
    
      <a href="/tags/mongodb">mongodb</a>, 
    
      <a href="/tags/mysql">mysql</a>, 
    
      <a href="/tags/nagios">nagios</a>, 
    
      <a href="/tags/node">node</a>, 
    
      <a href="/tags/nodejs">nodejs</a>, 
    
      <a href="/tags/npm">npm</a>, 
    
      <a href="/tags/opencart">opencart</a>, 
    
      <a href="/tags/phpmyadmin">phpmyadmin</a>, 
    
      <a href="/tags/programming">programming</a>, 
    
      <a href="/tags/python">python</a>, 
    
      <a href="/tags/raspberry-pi">raspberry-pi</a>, 
    
      <a href="/tags/react">react</a>, 
    
      <a href="/tags/react-router">react-router</a>, 
    
      <a href="/tags/reactjs">reactjs</a>, 
    
      <a href="/tags/redux">redux</a>, 
    
      <a href="/tags/s3">s3</a>, 
    
      <a href="/tags/sass">sass</a>, 
    
      <a href="/tags/script">script</a>, 
    
      <a href="/tags/scripts">scripts</a>, 
    
      <a href="/tags/snippets">snippets</a>, 
    
      <a href="/tags/sql">sql</a>, 
    
      <a href="/tags/ssh">ssh</a>, 
    
      <a href="/tags/steganography">steganography</a>, 
    
      <a href="/tags/sublime-text">sublime-text</a>, 
    
      <a href="/tags/sync">sync</a>, 
    
      <a href="/tags/sysadmin">sysadmin</a>, 
    
      <a href="/tags/system-management">system-management</a>, 
    
      <a href="/tags/table">table</a>, 
    
      <a href="/tags/terminal">terminal</a>, 
    
      <a href="/tags/ubuntu">ubuntu</a>, 
    
      <a href="/tags/wifi">wifi</a>, 
    
      <a href="/tags/wordpress">wordpress</a>, 
    
      <a href="/tags/workflow">workflow</a>, 
    
  </section>

  <section>
    <h6>Most Used Tags</h6>
    
      <a href="/tags/linux">linux</a>,
    
      <a href="/tags/es2015">es2015</a>,
    
      <a href="/tags/how-to">how-to</a>,
    
      <a href="/tags/array-methods">array-methods</a>,
    
      <a href="/tags/bash">bash</a>,
    
      <a href="/tags/commands">commands</a>,
    
      <a href="/tags/cheatsheet">cheatsheet</a>,
    
      <a href="/tags/concepts">concepts</a>,
    
      <a href="/tags/mysql">mysql</a>,
    
      <a href="/tags/free">free</a>,
    
      <a href="/tags/sass">sass</a>,
    
      <a href="/tags/compass">compass</a>,
    
      <a href="/tags/python">python</a>,
    
      <a href="/tags/backups">backups</a>,
    
      <a href="/tags/editor">editor</a>,
    
      <a href="/tags/hugo">hugo</a>,
    
      <a href="/tags/opencart">opencart</a>,
    
      <a href="/tags/raspberry-pi">raspberry-pi</a>,
    
      <a href="/tags/basics">basics</a>,
    
      <a href="/tags/database">database</a>,
    
  </section>


</div>


  
  <div id="main">


<h1 class="post_title">Automated MySQL Backups to Amazon S3 with AutoMySQLBackups</h1>


<div class="post_meta">
  
    
    
  
    
    
    
      <div class="meta_date"><strong>Last updated on:</strong> Aug 19, 2014</div>
    
  
    
    
    <div class="meta_section"><strong>Section:</strong> 
      
        <a href="/databases">Databases</a>
          
    </div>


    
     
      <div class="meta_tags">
        <strong>Tags:</strong>
        
         
        
          
            <a href="/tags/amazon-s3">#amazon s3</a>
          
            <a href="/tags/mysql">#mysql</a>
          
            <a href="/tags/backups">#backups</a>
          
            <a href="/tags/crontab">#crontab</a>
          
            <a href="/tags/database">#database</a>
          
        
      </div>
    
  
  </div>



<div class="content">
    

<p>This how-to will teach you how to take automated backups of all your MySQL databases and send them to Amazon S3.</p>

<h2 id="access-logins-required">Access (Logins) required</h2>

<ol>
<li><p>root login for the server (sudo is required to run automysqlbackup, root is req. to add to root user’s cron)</p></li>

<li><p>admin login for the mysql server (to provide for backup config file)</p></li>

<li><p>IAM access keys to use with s3cmd (to configure s3cmd)</p></li>
</ol>

<p>sudo is required to run the AutoMySQLBackup script, so when adding the command to cron, you&rsquo;d need to add it to the root user&rsquo;s cron (so that it runs successfully on set intervals without asking for a password).</p>

<h2 id="tools">Tools</h2>

<ol>
<li><a href="http://sourceforge.net/projects/automysqlbackup/" target="_blank">AutoMySQLBackup</a></li>
<li><a href="http://s3tools.org/repositories" target="_blank">s3cmd</a></li>
<li>SSH client (Terminal on Mac / <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/" target="_blank">putty</a> on Windows)</li>
</ol>

<h2 id="installing-s3cmd-on-debian">Installing S3cmd on Debian</h2>

<p>Check the <a href="http://s3tools.org/repositories" target="_blank">Repos</a> page for install on other systems.</p>

<ol>
<li>Import S3tools signing key:
<code>wget -O- -q http://s3tools.org/repo/deb-all/stable/s3tools.key | sudo apt-key add -</code></li>
<li>Add the repo to sources.list:
<code>sudo wget -O/etc/apt/sources.list.d/s3tools.list http://s3tools.org/repo/deb-all/stable/s3tools.list</code></li>
<li>Refresh package cache and install the newest s3cmd:
<code>sudo apt-get update &amp;&amp; sudo apt-get install s3cmd</code></li>
</ol>

<p>Run <code>s3cmd --configure</code> to configure settings and add IAM access keys for Amazon S3.</p>

<h2 id="installing-automysqlbackup">Installing AutoMySQLBackup</h2>

<p>Download and extract the latest tarball and run the install script.</p>

<ul>
<li>Create a directory where you want to download and extract the AutoMySQLBackup file and move to that directory.</li>
</ul>

<pre><code class="language-bash">sudo mkdir /automysqlbackup &amp;&amp; cd /automysqlbackup
</code></pre>

<ul>
<li>Download automysqlbackup (v3.0_rc6) to the server. (Check <a href="http://sourceforge.net/projects/automysqlbackup" target="_blank">Sourceforge</a> for the latest version of AutoMySQLBackup. As of this writing v3.0_rc6 is the latest)</li>
</ul>

<pre><code class="language-bash">wget http://kaz.dl.sourceforge.net/project/automysqlbackup/AutoMySQLBackup/AutoMySQLBackup%20VER%203.0/automysqlbackup-v3.0_rc6.tar.gz
</code></pre>

<ul>
<li>Extraxt the downloaded tarball</li>
</ul>

<pre><code class="language-bash">tar zxvf automysqlbackup-v3.0_rc6.tar.gz
</code></pre>

<ul>
<li>Run the installer</li>
</ul>

<pre><code class="language-bash">./install.sh
</code></pre>

<p>By default it will install the configuration files in <code>/etc/automysqlbackup</code> and the executable files in <code>/usr/local/bin</code>.</p>

<h2 id="configuring-automysqlbackup">Configuring AutoMySQLBackup</h2>

<p>Edit the <code>/etc/automysqlbackup/myserver.conf</code> file to customise your settings.
The myserver.conf file is VERY well documented, all you have to do is read and it&rsquo;ll tell you what setting is supposed to do what and how you should configure it. You do not need to edit beyond the basics. What you generally edit are basic settings (username, passsword, host and backup directory), database settings (which ones to backups, which ones to not), rotation settings (when to backup), and notification settings (who and what to tell when a backup is complete).</p>

<pre><code class="language-bash"># Basic Settings
CONFIG_mysql_dump_username='root'
CONFIG_mysql_dump_password='password'
CONFIG_mysql_dump_host='localhost'
CONFIG_mysql_dump_host_friendly='Main MySQL Server'
CONFIG_backup_dir='/backup/db'
</code></pre>

<pre><code class="language-bash"># Databases to backup

# List of databases for Daily/Weekly Backup e.g. ( 'DB1' 'DB2' 'DB3' ... )
# set to (), i.e. empty, if you want to backup all databases
CONFIG_db_names=()

# List of databases for Monthly Backups.
# set to (), i.e. empty, if you want to backup all databases
CONFIG_db_month_names=()

# List of DBNAMES to EXLUCDE if DBNAMES is empty, i.e. ().
CONFIG_db_exclude=( 'information_schema' )
</code></pre>

<pre><code class="language-bash"># Rotation Settings

# Which day do you want backups?
CONFIG_do_monthly=&quot;01&quot;
CONFIG_do_weekly=&quot;5&quot;

# Set rotation of daily backups.
CONFIG_rotation_daily=7
CONFIG_rotation_weekly=14
CONFIG_rotation_monthly=12
</code></pre>

<pre><code class="language-bash"># Notification setup

# What would you like to be mailed to you?
# - log   : send only log file
# - files : send log file and sql files as attachments (see docs)
# - stdout : will simply output the log to the screen if run manually.
# - quiet : Only send logs if an error occurs to the MAILADDR.
CONFIG_mailcontent='log'

# Email Address to send mail to? (user@domain.com)
CONFIG_mail_address='hello@aamnah.com'
</code></pre>

<p>Don&rsquo;t forget to <strong>create the backup directory</strong>. To test run, run the command <code>automysqlbackup /etc/automysqlbackup/myserver.conf</code></p>

<h2 id="adding-automysqlbackup-to-cron">Adding AutoMySQLBackup to Cron</h2>

<p>Edit crontab <code>sudo crontab -e</code> and add the following at the end.</p>

<pre><code class="language-bash"># AutoMySQLbackup run command for backing up databases every day at 12:05am.
5 0 * * * sudo automysqlbackup /etc/automysqlbackup/myserver.conf

# Copy backed up databases to Amazon S3 via s3cmd, daily at 5am.
0 5 * * * sudo s3cmd -r sync /backup/location/ s3://location/
</code></pre>

<h2 id="creating-an-alias">Creating an Alias</h2>

<p>To run database backups and send them to S3 with one single word, make an alias for it. Edit your <code>.bash_profile</code> (or <code>.bashrc</code>) and add the following at the end:</p>

<pre><code class="language-bash"># backup databases and send them to S3
alias backupdb='automysqlbackup /etc/automysqlbackup/myserver.conf &amp;&amp; s3cmd sync -r /backup/location/ s3://location/'
</code></pre>

<p>Now that you have made an alias, every time you run <code>backupdb</code> in the terminal, it&rsquo;ll take database backups and send them to S3. Creating an alias is good for manually taking database backups as it saves you the effort of remembering and writing two different commands.</p>

</div>






  <div class="related">
    <h6>Related</h6>
      <ul>
        
          <li><a href="/linux/basics-crontab/">Crontab Basics</a></li>
        
          <li><a href="/cheatsheets/cheatsheet-amazon-rds-commands-mysql/">Amazon RDS &#43; MySQL</a></li>
        
          <li><a href="/misc/fileconveyer/">fileconveyer</a></li>
        
      </ul>
  </div>



<footer id="footer">
<hr>
  <section>
    Please note that this site and the posts on it are, and will always be, a work in progress. If i waited for perfection, i’d never get anything done.
  </section>
  <span class="copyright"> Copyright &copy; 2014 - 2014 Aamnah. All rights reserved.</span>
</footer>

</div>

<script src='/prism/prism.js'></script>
</body>
</html>